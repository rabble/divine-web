<!DOCTYPE html>
<html>
<head>
    <title>Test Divine Video Parsing</title>
</head>
<body>
    <h1>Test Divine Video Parsing</h1>
    <div id="result"></div>
    
    <script type="module">
        // Simulate the event structure from Divine
        const mockEvent = {
            id: 'test-event-1',
            kind: 32222,
            pubkey: 'test-pubkey',
            created_at: Date.now() / 1000,
            content: 'Test video',
            tags: [
                ["streaming", "https://cdn.divine.video/c58613baa5fad079fa401c938db1e817/manifest/video.m3u8", "hls"],
                ["d", "test-vine-id"],
                ["t", "test"]
            ],
            sig: ''
        };
        
        // Test the parsing logic
        function extractVideoUrl(event) {
            console.log('[Test] Extracting from event:', event.id);
            console.log('[Test] Tags:', JSON.stringify(event.tags));
            
            // Check streaming tag
            const streamingTag = event.tags.find(tag => tag[0] === 'streaming' && tag[2] === 'hls');
            if (streamingTag && streamingTag[1]) {
                console.log('[Test] Found streaming URL:', streamingTag[1]);
                return streamingTag[1];
            }
            
            return null;
        }
        
        const url = extractVideoUrl(mockEvent);
        
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = `
            <p><strong>Event ID:</strong> ${mockEvent.id}</p>
            <p><strong>Tags:</strong> <pre>${JSON.stringify(mockEvent.tags, null, 2)}</pre></p>
            <p><strong>Extracted URL:</strong> ${url || 'None found'}</p>
            ${url ? `
                <h2>Test Video Player</h2>
                <video controls width="400" src="${url}">
                    Your browser does not support the video tag.
                </video>
                <p>Note: HLS (.m3u8) videos may not play in all browsers without additional libraries.</p>
            ` : ''}
        `;
        
        console.log('[Test] Final result:', { url });
    </script>
</body>
</html>