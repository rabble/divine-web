<!DOCTYPE html>
<html>
<head>
    <title>Raw WebSocket Test</title>
</head>
<body>
    <h1>Testing Raw WebSocket Connection</h1>
    <div id="log"></div>

    <script>
        const log = (msg) => {
            console.log(msg);
            const div = document.getElementById('log');
            div.innerHTML += `<p>${new Date().toISOString()}: ${msg}</p>`;
        };

        // Test multiple relays
        const relays = [
            'wss://relay.divine.video',
            'wss://relay.nostr.band',
            'wss://relay.damus.io'
        ];

        const testRelay = relays[0]; // Change to 1 or 2 to test others
        log('Creating WebSocket connection to ' + testRelay);

        const ws = new WebSocket(testRelay);

        ws.onopen = () => {
            log('✅ WebSocket OPENED! readyState: ' + ws.readyState);

            // Send a REQ message
            const req = JSON.stringify(['REQ', 'test-123', { kinds: [34236], limit: 5 }]);
            log('Sending REQ: ' + req);
            ws.send(req);
        };

        ws.onerror = (error) => {
            log('❌ WebSocket ERROR: ' + JSON.stringify(error));
            log('Error type: ' + error.type);
            log('readyState: ' + ws.readyState);
        };

        ws.onclose = (event) => {
            log(`❌ WebSocket CLOSED: code=${event.code}, reason=${event.reason}, wasClean=${event.wasClean}`);
        };

        ws.onmessage = (event) => {
            log('📥 Received: ' + event.data.substring(0, 200));

            const msg = JSON.parse(event.data);
            if (msg[0] === 'EVENT') {
                log('Got EVENT!');
            } else if (msg[0] === 'EOSE') {
                log('Got EOSE - closing connection');
                ws.close();
            }
        };

        // Timeout check
        setTimeout(() => {
            log('After 3 seconds, readyState: ' + ws.readyState + ' (0=CONNECTING, 1=OPEN, 2=CLOSING, 3=CLOSED)');
        }, 3000);
    </script>
</body>
</html>
