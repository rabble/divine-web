---
title: "12:03:00 PM - October 29, 2025"
date: 2025-10-28T23:03:00.357Z
timestamp: 1761692580357
---

## Project Notes

## Divine Web - WebSocket Connection Fix

**Issue**: Videos not loading - "No videos found" despite relay having 20+ videos.

**Investigation Process**:
1. Initially suspected cache issues - bypassed cache, issue persisted
2. Tried upgrading/downgrading Nostrify - not the issue
3. Created systematic Playwright test showing WebSocket timing
4. Read Nostrify source code (NRelay1.ts, NPool.ts) to understand connection lifecycle
5. Created Node.js timing test - worked perfectly (433ms query with 6 events)
6. Identified browser-specific race condition

**Fix Applied**:
- Added connection pre-warming in NostrProvider.tsx (useEffect calling pool.relay())
- Disabled HLS for 6-second videos (too short for adaptive streaming)
- Documented in WEBSOCKET_CONNECTION_FIX.md

**Files Modified**:
- src/components/NostrProvider.tsx - Added pre-warming effect
- src/hooks/useVideoEvents.ts - Disabled hlsUrl (lines 154, 246)
- src/lib/cachedNostr.ts - Currently bypassing cache (can re-enable later)

**Next Steps**:
- Verify fix works in browser (dev server running at localhost:8080)
- Once confirmed, can consider re-enabling cache
- Monitor for any similar timing issues

**Testing Strategy Used**:
- Created multiple test scripts (test-connection-timing.mjs, test-browser-websocket.mjs)
- Read actual library source code instead of guessing
- Systematic analysis with timing logs
